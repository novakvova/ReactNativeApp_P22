<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>SignalR Chat Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        input, textarea, button {
            margin: 4px 0;
            width: 100%;
        }

        textarea {
            height: 60px;
        }

        pre {
            background: #111;
            color: #0f0;
            padding: 10px;
            height: 200px;
            overflow: auto;
        }
    </style>
</head>
<body>

    <h3>🔐 JWT</h3>
<textarea id="jwt" placeholder="Встав JWT токен"></textarea>

    <h3>💬 Чат</h3>
    <input id="chatId" type="number" placeholder="ID чату">

    <h3>✉️ Повідомлення</h3>
    <input id="message" type="text" placeholder="Текст повідомлення">

    <button onclick="connect()">🔌 Connect</button>
    <button onclick="join()">👥 Join Chat</button>
    <button onclick="send()">📤 Send</button>

    <h3>📜 Лог</h3>
<pre id="log"></pre>

    <script>
        let connection;

        function log(msg) {
            const logEl = document.getElementById("log");
            logEl.textContent += msg + "\n";
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function connect() {
            const jwt = document.getElementById("jwt").value;

            connection = new signalR.HubConnectionBuilder()
                .withUrl("http://local.task.test.com/hubs/chat", {
                    accessTokenFactory: () => jwt
                })
                .withAutomaticReconnect()
                .build();

            connection.on("ReceiveMessage", msg => {
                log("📩 ReceiveMessage: " + JSON.stringify(msg));
            });

            await connection.start();
            log("✅ Connected");
        }

        async function join() {
            const chatId = Number(document.getElementById("chatId").value);
            await connection.invoke("JoinChat", chatId);
            log(`👥 Joined chat ${chatId}`);
        }

        async function send() {
            const chatId = Number(document.getElementById("chatId").value);
            const message = document.getElementById("message").value;

            await connection.invoke("SendMessage", {
                chatId,
                message
            });

            log(`📤 Sent message to chat ${chatId}`);
        }
    </script>

</body>
</html>
